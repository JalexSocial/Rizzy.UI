@namespace RizzyUI

@inherits RizzyComponent

@* SidebarLinkItem Component *@
@if (Collapsible)
{
    <!-- Collapsible item -->
    <li>
        <div x-data="{ isExpanded: @((!Collapsed).ToString().ToLowerInvariant()) }" class="flex flex-col">
            <button type="button" x-on:click="isExpanded = ! isExpanded" id="@ButtonId" aria-controls="@CollapseId" x-bind:aria-expanded="isExpanded.toString()" class="@ButtonClass">
                @if (!string.IsNullOrEmpty(Icon))
                {
                    <svg class="size-5 shrink-0" aria-hidden="true">
                        @((MarkupString)IconDictionary[Icon])
                    </svg>
                }
                <span class="mr-auto text-left">@Title</span>
                @if (TrailerContent != null)
                {
                    <div class="ml-auto">
                        @TrailerContent
                    </div>
                }
                <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" class="size-5 transition-transform rotate-0 shrink-0" x-bind:class="isExpanded ? 'rotate-180' : 'rotate-0'" aria-hidden="true">
                    <!-- Arrow icon SVG -->
                    <path fill-rule="evenodd" d="M5.22 8.22a.75.75 0 0 1 1.06 0L10 11.94l3.72-3.72a.75.75 0 1 1 1.06 1.06l-4.25 4.25a.75.75 0 0 1-1.06 0L5.22 9.28a.75.75 0 0 1 0-1.06Z" clip-rule="evenodd" />
                </svg>
            </button>
            <ul x-cloak x-collapse x-show="isExpanded" aria-labelledby="@ButtonId" id="@CollapseId">
                <CascadingValue Value="this">
                    @ChildContent
                </CascadingValue>
            </ul>
        </div>
    </li>
}
else
{
    <!-- Non-collapsible item -->
    @if (Parent is { HasChildren: true, Collapsible: false })
    {
        <li class="border-l px-2 py-0.5 border-slate-300 dark:border-slate-700">
            <a href="@Href" target="@Target" class="@LinkClass">
                @if (!string.IsNullOrEmpty(Icon))
                {
                    <svg class="size-5 shrink-0" aria-hidden="true">
                        @((MarkupString)IconDictionary[Icon])
                    </svg>
                }
                <span>@Title</span>
                @if (TrailerContent != null)
                {
                    <div class="ml-auto">
                        @TrailerContent
                    </div>
                }
            </a>
            @if (ChildContent != null)
            {
                <ul class="pl-4">
                    <CascadingValue Value="this">
                        @ChildContent
                    </CascadingValue>
                </ul>
            }
        </li>
    }
    else
    {
        <li class="px-1 py-0.5 first:mt-2">
        <a href="@Href" target="@Target" class="@LinkClass">
            @if (!string.IsNullOrEmpty(Icon))
            {
                <svg class="size-5 shrink-0" aria-hidden="true">
                    @((MarkupString)IconDictionary[Icon])
                </svg>
            }
            <span>@Title</span>
            @if (TrailerContent != null)
            {
                <div class="ml-auto">
                    @TrailerContent
                </div>
            }
        </a>
        @if (ChildContent != null)
        {
            <ul class="pl-4">
                <CascadingValue Value="this">
                    @ChildContent
                </CascadingValue>
            </ul>
        }
        </li>
    }
}

@code {
    [Parameter]
    public string Icon { get; set; }

    [Parameter]
    public string Title { get; set; }

    [Parameter]
    public string Href { get; set; }

    [Parameter]
    public string Target { get; set; } = "_self";

    [Parameter]
    public RenderFragment? TrailerContent { get; set; }

    [Parameter]
    public bool Collapsible { get; set; } = false;

    [Parameter]
    public bool Collapsed { get; set; } = true;

    [CascadingParameter] 
    public SidebarLinkItem? Parent { get; set; }

    private string _buttonId;
    private string _collapseId;
    protected bool HasChildren { get; set; } = false;

    protected override void OnInitialized()
    {
        if (Collapsible)
        {
            var guid = Guid.NewGuid().ToString("N");
            _buttonId = $"btn-{guid}";
            _collapseId = $"clps-{guid}";
        }

        if (Parent != null)
            Parent.HasChildren = true;

        StateHasChanged();
    }

    private string ButtonId => _buttonId;

    private string CollapseId => _collapseId;

    private string ButtonClass => "flex items-center justify-between rounded-xl gap-2 px-2 py-1.5 text-sm font-medium underline-offset-2 focus:outline-none focus-visible:underline text-slate-700 hover:bg-blue-700/5 hover:text-black dark:text-slate-300 dark:hover:text-white dark:hover:bg-blue-600/5";

    private string LinkClass => Parent?.HasChildren == true
        ? "flex items-center gap-2 px-2 py-1.5 text-sm rounded-xl text-slate-700 underline-offset-2 hover:bg-blue-700/5 hover:text-black focus-visible:underline focus:outline-none dark:text-slate-300 dark:hover:bg-blue-600/5 dark:hover:text-white"
        : "flex items-center gap-2 px-2 py-1.5 text-sm rounded-xl font-medium text-slate-700 underline-offset-2 hover:bg-blue-700/5 hover:text-black focus-visible:underline focus:outline-none dark:text-slate-300 dark:hover:bg-blue-600/5 dark:hover:text-white";

    private Dictionary<string, string> IconDictionary = new Dictionary<string, string>
    {
        // Add SVG icons here, keyed by the string Icon
        { "DashboardIcon", "<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 20 20\" fill=\"currentColor\" aria-hidden=\"true\"><path d=\"M15.5 2A1.5 1.5 0 0 0 14 3.5v13a1.5 1.5 0 0 0 1.5 1.5h1a1.5 1.5 0 0 0 1.5-1.5v-13A1.5 1.5 0 0 0 16.5 2h-1ZM9.5 6A1.5 1.5 0 0 0 8 7.5v9A1.5 1.5 0 0 0 9.5 18h1a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 10.5 6h-1ZM3.5 10A1.5 1.5 0 0 0 2 11.5v5A1.5 1.5 0 0 0 3.5 18h1A1.5 1.5 0 0 0 6 16.5v-5A1.5 1.5 0 0 0 4.5 10h-1Z\"/></svg>" },
        { "UserManagementIcon", "<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 20 20\" fill=\"currentColor\" aria-hidden=\"true\"><path d=\"M7 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6ZM14.5 9a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5ZM1.615 16.428a1.224 1.224 0 0 1-.569-1.175 6.002 6.002 0 0 1 11.908 0c.058.467-.172.92-.57 1.174A9.953 9.953 0 0 1 7 18a9.953 9.953 0 0 1-5.385-1.572ZM14.5 16h-.106c.07-.297.088-.611.048-.933a7.47 7.47 0 0 0-1.588-3.755 4.502 4.502 0 0 1 5.874 2.636.818.818 0 0 1-.36.98A7.465 7.465 0 0 1 14.5 16Z\"/></svg>" },
        { "ProductsIcon", "<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 20 20\" fill=\"currentColor\" aria-hidden=\"true\"><path d=\"M10.362 1.093a.75.75 0 0 0-.724 0L2.523 5.018 10 9.143l7.477-4.125-7.115-3.925ZM18 6.443l-7.25 4v8.25l6.862-3.786A.75.75 0 0 0 18 14.25V6.443ZM9.25 18.693v-8.25l-7.25-4v7.807a.75.75 0 0 0 .388.657l6.862 3.786Z\"/></svg>" },
        { "OrdersIcon", "<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 20 20\" fill=\"currentColor\" aria-hidden=\"true\"><path d=\"M6.5 3c-1.051 0-2.093.04-3.125.117A1.49 1.49 0 0 0 2 4.607V10.5h9V4.606c0-.771-.59-1.43-1.375-1.489A41.568 41.568 0 0 0 6.5 3ZM2 12v2.5A1.5 1.5 0 0 0 3.5 16h.041a3 3 0 0 1 5.918 0h.791a.75.75 0 0 0 .75-.75V12H2Z\"/><path d=\"M6.5 18a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3ZM13.25 5a.75.75 0 0 0-.75.75v8.514a3.001 3.001 0 0 1 4.893 1.44c.37-.275.61-.719.595-1.227a24.905 24.905 0 0 0-1.784-8.549A1.486 1.486 0 0 0 14.823 5H13.25ZM14.5 18a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3Z\"/></svg>" },
        { "SettingsIcon", "<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 20 20\" fill=\"currentColor\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M7.84 1.804A1 1 0 0 1 8.82 1h2.36a1 1 0 0 1 .98.804l.331 1.652a6.993 6.993 0 0 1 1.929 1.115l1.598-.54a1 1 0 0 1 1.186.447l1.18 2.044a1 1 0 0 1-.205 1.251l-1.267 1.113a7.047 7.047 0 0 1 0 2.228l1.267 1.113a1 1 0 0 1 .206 1.25l-1.18 2.045a1 1 0 0 1-1.187.447l-1.598-.54a6.993 6.993 0 0 1-1.929 1.115l-.33 1.652a1 1 0 0 1-.98.804H8.82a1 1 0 0 1-.98-.804l-.331-1.652a6.993 6.993 0 0 1-1.929-1.115l-1.598.54a1 1 0 0 1-1.186-.447l-1.18-2.044a1 1 0 0 1 .205-1.251l1.267-1.114a7.05 7.05 0 0 1 0-2.227L1.821 7.773a1 1 0 0 1-.206-1.25l1.18-2.045a1 1 0 0 1 1.187-.447l1.598.54A6.992 6.992 0 0 1 7.51 3.456l.33-1.652ZM10 13a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z\" clip-rule=\"evenodd\"/></svg>" },
        // ... add more icons as needed
    };
}
